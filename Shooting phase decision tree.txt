For each PLAYER unit
â”œâ”€â”€ ELIGIBILITY CHECK (Pool Building Phase)
â”‚   â”œâ”€â”€ unit.HP_CUR > 0?
â”‚   â”‚   â””â”€â”€ NO â†’ âŒ Dead unit (Skip, no log)
â”‚   â”œâ”€â”€ unit.player === current_player?
â”‚   â”‚   â””â”€â”€ NO â†’ âŒ Wrong player (Skip, no log)
â”‚   â”œâ”€â”€ units_fled.includes(unit.id)?
â”‚   â”‚   â””â”€â”€ YES â†’ âŒ Fled unit (Skip, no log)
â”‚   â”œâ”€â”€ Adjacent to enemy unit within CC_RNG?
â”‚   â”‚   â””â”€â”€ YES â†’ âŒ In fight (Skip, no log)
â”‚   â”œâ”€â”€ unit.RNG_NB > 0?
â”‚   â”‚   â””â”€â”€ NO â†’ âŒ No ranged weapon (Skip, no log)
â”‚   â”œâ”€â”€ Has LOS to enemies within RNG_RNG?
â”‚   â”‚   â””â”€â”€ NO â†’ âŒ No valid targets (Skip, no log)
â”‚   â””â”€â”€ ALL conditions met â†’ âœ… Add to shoot_activation_pool â†’ Highlight the unit with a green circle around its icon
â”œâ”€â”€ STEP : UNIT_ACTIVABLE_CHECK â†’ is shoot_activation_pool NOT empty ?
â”‚   â”œâ”€â”€ YES â†’ Current player is an AI player ?
â”‚   â”‚   â”œâ”€â”€ YES â†’ pick one unit in shoot_activation_pool
â”‚   â”‚   â”‚   â”œâ”€â”€ Clear any unit remaining in valid_target_pool
â”‚   â”‚   â”‚   â”œâ”€â”€ Clear TOTAL_ATTACK_LOG
â”‚   â”‚   â”‚   â”œâ”€â”€ SHOOT_LEFT = RNG_NB
â”‚   â”‚   â”‚   â”œâ”€â”€ While SHOOT_LEFT > 0
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Build valid_target_pool : All enemies within range AND in Line of Sight AND having HP_CUR > 0 â†’ added to valid_target_pool
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ valid_target_pool NOT empty ?
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ YES â†’ SHOOTING PHASE ACTIONS AVAILABLE
â”‚   â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ðŸŽ¯ VALID ACTIONS: [shoot, wait]
â”‚   â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ âŒ INVALID ACTIONS: [move, charge, attack] â†’ end_activation (ERROR, 0, PASS, SHOOTING)
â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AGENT ACTION SELECTION â†’ Choose shoot?
â”‚   â”‚   â”‚   â”‚       â”‚       â”œâ”€â”€ YES â†’ âœ… VALID â†’ Execute attack_sequence(RNG)
â”‚   â”‚   â”‚   â”‚       â”‚       â”‚   â”œâ”€â”€ SHOOT_LEFT -= 1
â”‚   â”‚   â”‚   â”‚       â”‚       â”‚   â”œâ”€â”€ Concatenate Return to TOTAL_ACTION log
â”‚   â”‚   â”‚   â”‚       â”‚       â”‚   â”œâ”€â”€ selected_target dies â†’ Remove from valid_target_pool, continue
â”‚   â”‚   â”‚   â”‚       â”‚       â”‚   â””â”€â”€ selected_target survives â†’ Continue
â”‚   â”‚   â”‚   â”‚       â”‚       â””â”€â”€ NO â†’ Agent chooses: wait?
â”‚   â”‚   â”‚   â”‚       â”‚           â”œâ”€â”€ YES â†’ âœ… VALID â†’ Execute wait action
â”‚   â”‚   â”‚   â”‚       â”‚           â”‚   â””â”€â”€ end_activation (WAIT, 1, PASS, SHOOTING)
â”‚   â”‚   â”‚   â”‚       â”‚           â””â”€â”€ NO â†’ Agent chooses invalid action (move/charge/attack)?
â”‚   â”‚   â”‚   â”‚       â”‚               â””â”€â”€ âŒ INVALID ACTION ERROR â†’ end_activation (ERROR, 0, PASS, SHOOTING)
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ NO â†’ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚   â”‚   â”‚           â”œâ”€â”€ NO â†’ shot the last target available in valid_target_pool â†’ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ YES â†’ no target available in valid_target_pool at activation â†’ no shoot â†’ end_activation (PASS, 1, PASS, SHOOTING)
â”‚   â”‚   â”‚   â”œâ”€â”€ Return: TOTAL_ACTION log
â”‚   â”‚   â”‚   â””â”€â”€ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â”‚   â””â”€â”€ NO â†’ Human player â†’ STEP : UNIT_ACTIVATION â†’ player activate one unit from shoot_activation_pool by left clicking on it
â”‚   â”‚       â”œâ”€â”€ Clear any unit remaining in valid_target_pool
â”‚   â”‚       â”œâ”€â”€ Clear TOTAL_ATTACK log
â”‚   â”‚       â”œâ”€â”€ SHOOT_LEFT = RNG_NB
â”‚   â”‚       â”œâ”€â”€ While SHOOT_LEFT > 0
â”‚   â”‚       â”‚   â”œâ”€â”€ Build valid_target_pool : All enemies within range AND in Line of Sight AND having HP_CUR > 0 â†’ added to valid_target_pool
â”‚   â”‚       â”‚   â””â”€â”€ valid_target_pool NOT empty ?
â”‚   â”‚       â”‚       â”œâ”€â”€ YES â†’ SHOOTING PHASE ACTIONS AVAILABLE
â”‚   â”‚       â”‚       â”‚   â””â”€â”€ STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”œâ”€â”€ Left click on a target in valid_target_pool â†’ Display the HP bar blinking animation
â”‚   â”‚       â”‚       â”‚       â”‚   â”œâ”€â”€ Left click a second time on the same selected_target
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Execute attack_sequence(RNG)
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ SHOOT_LEFT -= 1
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ Concatenate Return to TOTAL_ACTION log
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ selected_target dies â†’ Remove from valid_target_pool, continue
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â”œâ”€â”€ selected_target survives â†’ Continue
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”‚   â”œâ”€â”€ Left click on another target in valid_target_pool â†’ Change target
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â””â”€â”€ GO TO STEP : STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”‚   â”œâ”€â”€ Left click on another unit in shoot_activation_pool ?
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â””â”€â”€ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚       â”œâ”€â”€ YES â†’ Postpone the shooting phase for this unit
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚           â””â”€â”€  GO TO STEP : STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚       â””â”€â”€ NO â†’ The unit must end its activation when started
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚           â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”‚   â”œâ”€â”€ Left click on the active_unit
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”‚   â”œâ”€â”€ Right click on the active_unit
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚   â””â”€â”€ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚       â”œâ”€â”€ NO â†’ stop shooting on purpose â†’ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚           â””â”€â”€ GO TO STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚       â””â”€â”€ YES â†’ Cancel activation â†’ end_activation (WAIT, 1, PASS, SHOOTING)
â”‚   â”‚       â”‚       â”‚       â”‚   â”‚           â””â”€â”€ GO TO STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â”‚   â””â”€â”€ Left OR Right click anywhere else on the board
â”‚   â”‚       â”‚       â”‚       â”‚       â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”œâ”€â”€ Left click on another unit in shoot_activation_pool ?
â”‚   â”‚       â”‚       â”‚       â”‚   â””â”€â”€ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ YES â†’ Postpone the shooting phase for this unit
â”‚   â”‚       â”‚       â”‚       â”‚           â””â”€â”€ GO TO STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â”‚       â””â”€â”€ NO â†’ The unit must end its activation when started
â”‚   â”‚       â”‚       â”‚       â”‚           â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â”‚       â”œâ”€â”€ Left click on the active_unit â†’ No effect
â”‚   â”‚       â”‚       â”‚       â”œâ”€â”€ Right click on the active_unit
â”‚   â”‚       â”‚       â”‚       â”‚    â””â”€â”€ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ NO â†’ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â”€ GO TO STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â”‚       â””â”€â”€ YES â†’ end_activation (WAIT, 1, PASS, SHOOTING)
â”‚   â”‚       â”‚       â”‚       â”‚       â”‚   â””â”€â”€ GO TO STEP : UNIT_ACTIVABLE_CHECK
â”‚   â”‚       â”‚       â”‚       â””â”€â”€ Left OR Right click anywhere else on the board
â”‚   â”‚       â”‚       â”‚           â””â”€â”€ GO TO STEP : PLAYER_ACTION_SELECTION
â”‚   â”‚       â”‚       â””â”€â”€ NO â†’ SHOOT_LEFT = RNG_NB ?
â”‚   â”‚       â”‚           â”œâ”€â”€ NO â†’ shot the last target available in valid_target_pool â†’ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â”‚       â”‚           â””â”€â”€ YES â†’ no target available in valid_target_pool at activation â†’ no shoot â†’ end_activation (PASS, 1, PASS, SHOOTING)
â”‚   â”‚       â””â”€â”€ End of shooting â†’ end_activation (ACTION, 1, SHOOTING, SHOOTING)
â”‚   â””â”€â”€ No more activable units â†’ pass
â””â”€â”€ End of shooting phase â†’ Advance to charge phase