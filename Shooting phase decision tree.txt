For each PLAYER unit
├── ELIGIBILITY CHECK (Pool Building Phase)
│   ├── unit.HP_CUR > 0?
│   │   └── NO → ❌ Dead unit (Skip, no log)
│   ├── unit.player === current_player?
│   │   └── NO → ❌ Wrong player (Skip, no log)
│   ├── units_fled.includes(unit.id)?
│   │   └── YES → ❌ Fled unit (Skip, no log)
│   ├── Adjacent to enemy unit within CC_RNG?
│   │   └── YES → ❌ In fight (Skip, no log)
│   ├── unit.RNG_NB > 0?
│   │   └── NO → ❌ No ranged weapon (Skip, no log)
│   ├── Has LOS to enemies within RNG_RNG?
│   │   └── NO → ❌ No valid targets (Skip, no log)
│   └── ALL conditions met → ✅ Add to shoot_activation_pool → Highlight the unit with a green circle around its icon
├── STEP : UNIT_ACTIVABLE_CHECK → is shoot_activation_pool NOT empty ?
│   ├── YES → Current player is an AI player ?
│   │   ├── YES → pick one unit in shoot_activation_pool
│   │   │   ├── Clear any unit remaining in valid_target_pool
│   │   │   ├── Clear TOTAL_ATTACK_LOG
│   │   │   ├── SHOOT_LEFT = RNG_NB
│   │   │   ├── While SHOOT_LEFT > 0
│   │   │   │   ├── Build valid_target_pool : All enemies within range AND in Line of Sight AND having HP_CUR > 0 → added to valid_target_pool
│   │   │   │   └── valid_target_pool NOT empty ?
│   │   │   │       ├── YES → SHOOTING PHASE ACTIONS AVAILABLE
│   │   │   │       │   ├── 🎯 VALID ACTIONS: [shoot, wait]
│   │   │   │       │   ├── ❌ INVALID ACTIONS: [move, charge, attack] → end_activation (ERROR, 0, PASS, SHOOTING)
│   │   │   │       │   └── AGENT ACTION SELECTION → Choose shoot?
│   │   │   │       │       ├── YES → ✅ VALID → Execute attack_sequence(RNG)
│   │   │   │       │       │   ├── SHOOT_LEFT -= 1
│   │   │   │       │       │   ├── Concatenate Return to TOTAL_ACTION log
│   │   │   │       │       │   ├── selected_target dies → Remove from valid_target_pool, continue
│   │   │   │       │       │   └── selected_target survives → Continue
│   │   │   │       │       └── NO → Agent chooses: wait?
│   │   │   │       │           ├── YES → ✅ VALID → Execute wait action
│   │   │   │       │           │   └── end_activation (WAIT, 1, PASS, SHOOTING)
│   │   │   │       │           └── NO → Agent chooses invalid action (move/charge/attack)?
│   │   │   │       │               └── ❌ INVALID ACTION ERROR → end_activation (ERROR, 0, PASS, SHOOTING)
│   │   │   │       └── NO → SHOOT_LEFT = RNG_NB ?
│   │   │   │           ├── NO → shot the last target available in valid_target_pool → end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   │   │   │           └── YES → no target available in valid_target_pool at activation → no shoot → end_activation (PASS, 1, PASS, SHOOTING)
│   │   │   ├── Return: TOTAL_ACTION log
│   │   │   └── end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   │   └── NO → Human player → STEP : UNIT_ACTIVATION → player activate one unit from shoot_activation_pool by left clicking on it
│   │       ├── Clear any unit remaining in valid_target_pool
│   │       ├── Clear TOTAL_ATTACK log
│   │       ├── SHOOT_LEFT = RNG_NB
│   │       ├── While SHOOT_LEFT > 0
│   │       │   ├── Build valid_target_pool : All enemies within range AND in Line of Sight AND having HP_CUR > 0 → added to valid_target_pool
│   │       │   └── valid_target_pool NOT empty ?
│   │       │       ├── YES → SHOOTING PHASE ACTIONS AVAILABLE
│   │       │       │   └── STEP : PLAYER_ACTION_SELECTION
│   │       │       │       ├── Left click on a target in valid_target_pool → Display the HP bar blinking animation
│   │       │       │       │   ├── Left click a second time on the same selected_target
│   │       │       │       │   │   ├── Execute attack_sequence(RNG)
│   │       │       │       │   │   ├── SHOOT_LEFT -= 1
│   │       │       │       │   │   ├── Concatenate Return to TOTAL_ACTION log
│   │       │       │       │   │   ├── selected_target dies → Remove from valid_target_pool, continue
│   │       │       │       │   │   ├── selected_target survives → Continue
│   │       │       │       │   │   └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       │       │   ├── Left click on another target in valid_target_pool → Change target
│   │       │       │       │   │   └── GO TO STEP : STEP : PLAYER_ACTION_SELECTION
│   │       │       │       │   ├── Left click on another unit in shoot_activation_pool ?
│   │       │       │       │   │   └── SHOOT_LEFT = RNG_NB ?
│   │       │       │       │   │       ├── YES → Postpone the shooting phase for this unit
│   │       │       │       │   │           └──  GO TO STEP : STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       │   │       └── NO → The unit must end its activation when started
│   │       │       │       │   │           └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       │       │   ├── Left click on the active_unit
│   │       │       │       │   │   └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       │       │   ├── Right click on the active_unit
│   │       │       │       │   │   └── SHOOT_LEFT = RNG_NB ?
│   │       │       │       │   │       ├── NO → stop shooting on purpose → end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   │       │       │       │   │           └── GO TO STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       │   │       └── YES → Cancel activation → end_activation (WAIT, 1, PASS, SHOOTING)
│   │       │       │       │   │           └── GO TO STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       │   └── Left OR Right click anywhere else on the board
│   │       │       │       │       └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       │       ├── Left click on another unit in shoot_activation_pool ?
│   │       │       │       │   └── SHOOT_LEFT = RNG_NB ?
│   │       │       │       │       ├── YES → Postpone the shooting phase for this unit
│   │       │       │       │           └── GO TO STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       │       └── NO → The unit must end its activation when started
│   │       │       │       │           └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       │       ├── Left click on the active_unit → No effect
│   │       │       │       ├── Right click on the active_unit
│   │       │       │       │    └── SHOOT_LEFT = RNG_NB ?
│   │       │       │       │       ├── NO → end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   │       │       │       │       │   └── GO TO STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       │       └── YES → end_activation (WAIT, 1, PASS, SHOOTING)
│   │       │       │       │       │   └── GO TO STEP : UNIT_ACTIVABLE_CHECK
│   │       │       │       └── Left OR Right click anywhere else on the board
│   │       │       │           └── GO TO STEP : PLAYER_ACTION_SELECTION
│   │       │       └── NO → SHOOT_LEFT = RNG_NB ?
│   │       │           ├── NO → shot the last target available in valid_target_pool → end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   │       │           └── YES → no target available in valid_target_pool at activation → no shoot → end_activation (PASS, 1, PASS, SHOOTING)
│   │       └── End of shooting → end_activation (ACTION, 1, SHOOTING, SHOOTING)
│   └── No more activable units → pass
└── End of shooting phase → Advance to charge phase